(function(t){function e(e){for(var r,i,s=e[0],l=e[1],u=e[2],p=0,h=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&h.push(n[i][0]),n[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);c&&c(e);while(h.length)h.shift()();return a.push.apply(a,u||[]),o()}function o(){for(var t,e=0;e<a.length;e++){for(var o=a[e],r=!0,s=1;s<o.length;s++){var l=o[s];0!==n[l]&&(r=!1)}r&&(a.splice(e--,1),t=i(i.s=o[0]))}return t}var r={},n={app:0},a=[];function i(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=r,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dryga5/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var c=l;a.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"56d7":function(t,e,o){"use strict";o.r(e);o("e260"),o("e6cf"),o("cca6"),o("a79d");var r=o("2b0e"),n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("div",{attrs:{id:"map"}},[o("div",{staticClass:"custom-control"},[o("select",{directives:[{name:"model",rawName:"v-model",value:t.drone,expression:"drone"}],attrs:{name:"drone",id:"drone"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.drone=e.target.multiple?o:o[0]}}},t._l(t.droneModels,(function(e,r){return o("option",{key:r,domProps:{value:e}},[t._v(t._s(e.name))])})),0),o("div",{staticClass:"input-wrapper"},[o("label",{attrs:{for:"height"}},[t._v("Высота(м) :")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.height,expression:"height"}],attrs:{type:"number",name:"height",step:1},domProps:{value:t.height},on:{input:function(e){e.target.composing||(t.height=e.target.value)}}})]),o("div",{staticClass:"input-wrapper"},[o("label",{attrs:{for:"px"}},[t._v("Px% : ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.px,expression:"px"}],attrs:{type:"number",name:"px",step:1},domProps:{value:t.px},on:{input:function(e){e.target.composing||(t.px=e.target.value)}}})]),o("div",{staticClass:"input-wrapper"},[o("label",{attrs:{for:"py"}},[t._v("Py% : ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.py,expression:"py"}],attrs:{type:"number",name:"py",step:1},domProps:{value:t.py},on:{input:function(e){e.target.composing||(t.py=e.target.value)}}})]),o("div",{staticClass:"input-wrapper"},[o("label",{attrs:{for:"speed"}},[t._v("Скорость(м/с) : ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.speed,expression:"speed"}],attrs:{type:"number",name:"speed",step:1},domProps:{value:t.speed},on:{input:function(e){e.target.composing||(t.speed=e.target.value)}}})]),o("div",{staticClass:"input-wrapper"},[o("label",{attrs:{for:"offset"}},[t._v("Оффсет : ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.offset,expression:"offset"}],attrs:{type:"number",name:"offset",step:.01,min:1},domProps:{value:t.offset},on:{input:function(e){e.target.composing||(t.offset=e.target.value)}}})]),t.drone?o("div",{staticClass:"info-wrapper"},[t._v(" GSD: "+t._s(t.gsd.toFixed(4))+" m/px "),o("br"),t._v(" Время полета: "+t._s(t.flightTime)+" с "),o("br"),o("input",{attrs:{type:"button",value:"Построить"},on:{click:function(e){return e.preventDefault(),t.createRoutes()}}}),o("input",{attrs:{type:"button",value:"Срезать"},on:{click:function(e){return e.preventDefault(),t.slice()}}})]):t._e()])])])},a=[],i=(o("d81d"),o("fb6a"),o("b680"),o("acd8"),o("e11e")),s=o.n(i),l=o("595b"),u=(o("91db"),o("f5df1"),o("6cc5"),o("46e6"),o("20d6"),o("5fbf"),o("3022"),{name:"app",data:function(){return{center:s.a.latLng(55.14454538318123,37.456169128417976),url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",map:null,params:null,drone:null,features:null,polygon:null,height:80,px:70,py:35,drawControl:null,bSquare:null,route:null,angle:0,prevYaw:0,speed:10,flightTime:0,offset:1,polygonInit:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.45449542999267,55.1442204061936],[37.45447397232056,55.14200068127899],[37.45987057685852,55.14200068127899],[37.45980620384216,55.1442694594934],[37.45449542999267,55.1442204061936]]]}},droneModels:[{name:"Phantom 3 St,Adv,Pro, Phantom 4",widthPx:4e3,heightPx:3e3,width:6.24,height:4.68,focal:3.61,pixelSize:.00156},{name:"Phantom 4Pro/Adv",widthPx:5472,heightPx:3648,width:12.86,height:8.57,focal:8.57,pixelSize:.00235},{name:"Mavic 2 Pro",widthPx:5472,heightPx:3648,width:13.19,height:8.79,focal:10.26,pixelSize:.00241}]}},mounted:function(){var t=this;this.$nextTick((function(){t.map=s.a.map("map").setView(t.center,16),s.a.tileLayer(t.url,{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(t.map),t.features=new s.a.FeatureGroup,t.map.addLayer(t.features),t.polygon=s.a.polygon(Object(l["coordAll"])(Object(l["flip"])(t.polygonInit))).addTo(t.features),t.bSquare=s.a.geoJSON(Object(l["bboxPolygon"])(t.squreBbox(Object(l["bbox"])(t.polygon.toGeoJSON())))).addTo(t.features),t.route=s.a.polyline([[0,0],[1,1]],{transform:!0}).addTo(t.features),t.drawControl=new s.a.Control.Draw({position:"topright",draw:!1,edit:{featureGroup:t.features}}),t.map.addControl(t.drawControl),t.initEvents()}))},methods:{slice:function(){for(var t=Object(l["flip"])(this.route.toGeoJSON()),e=Object(l["flip"])(Object(l["transformScale"])(this.polygon.toGeoJSON(),parseFloat(this.offset))),o=Object(l["transformScale"])(e,parseFloat(this.offset)+.01),r=Object(l["lineIntersect"])(t,e),n=r.features.map((function(t){return t.geometry.coordinates})),a=[],i=0;i<n.length-1;i++)a.push(Object(l["lineSlice"])(Object(l["point"])(n[i]),Object(l["point"])(n[i+1]),t));for(var s=[],u=0;u<a.length;u++){var c=Object(l["point"])(a[u].geometry.coordinates[0]),p=Object(l["point"])(a[u].geometry.coordinates[a[u].geometry.coordinates.length-1]),h=a[u].geometry.coordinates[2];Object(l["booleanPointInPolygon"])(p,o)&&Object(l["booleanPointInPolygon"])(c,o)&&!h&&s.push(a[u])}for(var d=[],f=0,b=!1,g=0;g<s.length;g++){var v=Object(l["coordAll"])(s[g]);0==g&&(f=Object(l["bearing"])(v[0],v[1])),Math.abs(Object(l["bearing"])(v[0],v[1])-f)>.01&&(b=!0,f=Object(l["bearing"])(v[0],v[1])),b?(g%2==0?d.push(v[0],v[1]):d.push(v[1],v[0]),f=Object(l["bearing"])(v[0],v[1])):(g%2!=0?d.push(v[0],v[1]):d.push(v[1],v[0]),f=Object(l["bearing"])(v[0],v[1]))}this.route.setLatLngs(d),this.route.transform.reset(),this.route.transform.disable(),this.flightTime=(1e3*Object(l["length"])(this.route.toGeoJSON())/this.speed).toFixed(0)},onEditVertex:function(t){var e=Object(l["bbox"])(t.poly.toGeoJSON()),o=this.squreBbox(e),r=Object(l["bboxPolygon"])(o);this.polygon=t.poly,this.bSquare.clearLayers(),this.bSquare.addData(r)},initEvents:function(){var t=this;this.map.on("draw:editvertex",(function(e){return t.onEditVertex(e)})),this.route.addEventListener("rotateend",(function(t){this.route=t.layer}))},squreBbox:function(t){var e=t[0],o=t[1],r=t[2],n=t[3],a=Object(l["distance"])(t.slice(0,2),[r,o]),i=Object(l["distance"])(t.slice(0,2),[e,n]);if(a>=i){var s=(o+n)/2,u=(e+r)/2;return[u+(r-e),s-(r-e)/2,u-(r-e),s+(r-e)/2]}var c=(e+r)/2,p=(o+n)/2;return[c+2*(n-o),p-(n-o),c-2*(n-o),p+(n-o)]},rotatePoints:function(t,e,o,r){for(var n=[],a=(o-r)*(Math.PI/180),i=0;i<e.length;i++){var s=e[i],l=[t[0]+Math.cos(a)*(s[0]-t[0])-Math.sin(a)*(s[1]-t[1]),t[1]+Math.sin(a)*(s[0]-t[0])+Math.cos(a)*(s[1]-t[1])];n.push(l)}return n},projectPoints:function(t){for(var e=[],o=0;o<t.length;o++){var r=s.a.CRS.EPSG3857.latLngToPoint(s.a.latLng(t[o]),this.map.getZoom());e.push([r.x,r.y])}return e},unprojectPoints:function(t){for(var e=[],o=0;o<t.length;o++){var r=s.a.CRS.EPSG3857.pointToLatLng(s.a.point(t[o]),this.map.getZoom());e.push([r.lat,r.lng])}return e},changeAngle:function(){var t=this.bSquare.toGeoJSON(),e=this.projectPoints([Object(l["centroid"])(t).geometry.coordinates]),o=this.projectPoints(Object(l["coordAll"])(t)),r=this.rotatePoints(e[0],o,this.angle,this.prevYaw),n=this.unprojectPoints(r);this.prevYaw=this.angle;var a=Object(l["polygon"])([n]);this.bSquare.clearLayers(),this.bSquare.addData(a)},getDx:function(){var t=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[1],e=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[3];return s.a.latLng(t).distanceTo(s.a.latLng(t[0],e[1]))},getDy:function(){var t=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[1],e=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[3];return s.a.latLng(t).distanceTo(s.a.latLng(e[0],t[1]))},getShotsCount:function(){return Math.ceil(this.getDx()/this.bx+3)},getRoutesCount:function(){return Math.ceil(this.getDy()/this.by+1)},rectSize:function(){var t=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[1],e=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[3],o={width:s.a.latLng(t).distanceTo(s.a.latLng(t[0],e[1])),height:s.a.latLng(t).distanceTo(s.a.latLng(e[0],t[1]))};return o},createRoutes:function(){for(var t=[],e=(this.rectSize(),Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[2]),o=6378137,r=this.by/o,n=0;n<this.getRoutesCount();n++){var a=this.bx/(o*Math.cos(Math.PI*(e[0]-r*n*180/Math.PI)/180));n%2==0?(t.push([e[0]-r*n*180/Math.PI,e[1]]),t.push([e[0]-r*n*180/Math.PI,e[1]+a*(this.getShotsCount()-3)*180/Math.PI])):(t.push([e[0]-r*n*180/Math.PI,e[1]+a*(this.getShotsCount()-3)*180/Math.PI]),t.push([e[0]-r*n*180/Math.PI,e[1]]))}this.route.setLatLngs(t),this.route.transform.reset(),this.route.transform.disable(),this.route.transform.enable({rotation:!0,scaling:!1})}},computed:{gsd:function(){var t=this.height*(this.drone.height/1e3)/(this.drone.focal/1e3*this.drone.heightPx),e=this.height*(this.drone.width/1e3)/(this.drone.focal/1e3*this.drone.widthPx);return t>e?t:e},bx:function(){return this.drone.widthPx*(100-this.px)/100*this.gsd},by:function(){return this.drone.heightPx*(100-this.py)/100*this.gsd},dx:function(){var t=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[1],e=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[3];return s.a.latLng(t).distanceTo(s.a.latLng(t[0],e[1]))},dy:function(){var t=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[1],e=Object(l["coordAll"])(Object(l["flip"])(this.bSquare.toGeoJSON()))[3];return s.a.latLng(t).distanceTo(s.a.latLng(e[0],t[1]))},shotsCount:function(){return Math.ceil(this.dx/this.bx+3)},routesCount:function(){return Math.ceil(this.dy/this.by+1)}},components:{}}),c=u,p=(o("5c0b"),o("2877")),h=Object(p["a"])(c,n,a,!1,null,null,null),d=h.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(d)}}).$mount("#app")},"5c0b":function(t,e,o){"use strict";var r=o("9c0c"),n=o.n(r);n.a},"9c0c":function(t,e,o){}});
//# sourceMappingURL=app.f2e012ea.js.map